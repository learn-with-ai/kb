<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">09. Advanced Techniques for Image Generation with Stable Diffusion | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/docs/AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="09. Advanced Techniques for Image Generation with Stable Diffusion | My Site"><meta data-rh="true" name="description" content="titles"><meta data-rh="true" property="og:description" content="titles"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/docs/AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/docs/AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.1724a0b2.css">
<script src="/assets/js/runtime~main.2d8c9eb9.js" defer="defer"></script>
<script src="/assets/js/main.ed51d313.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/docs/SE/ModelDriven/Part1_">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/AIEng/AIDevops/Introduction_content">AI Engineering Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/tags">Tags</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/AIEng/AIDevops/Introduction_content">AIDevops</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/AIEng/AIEngineering/Introduction to Building AI Applications with Foundation Models_content">AIEngineering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/AIEng/LangChain/00Preface_content">LangChain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/AIEng/PromptEng/The Five Principles of Prompting_content">PromptEng</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/The Five Principles of Prompting_content">01. The Five Principles of Prompting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Introduction to Large Language Models for Text Generation_content">02. Introduction to Large Language Models for Text Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Standard Practices for Text Generation with ChatGPT_content">03. Standard Practices for Text Generation with ChatGPT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Advanced Techniques for Text Generation with LangChain_content">04. Advanced Techniques for Text Generation with LangChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Vector Databases with FAISS and Pinecone_content">05. Vector Databases with FAISS and Pinecone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Autonomous Agents with Memory and Tools_content">06. Autonomous Agents with Memory and Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Introduction to Diffusion Models for Image Generation_content">07. Introduction to Diffusion Models for Image Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Standard Practices for Image Generation with Midjourney_content">08. Standard Practices for Image Generation with Midjourney</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/AIEng/PromptEng/Advanced Techniques for Image Generation with Stable Diffusion_content">09. Advanced Techniques for Image Generation with Stable Diffusion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/AIEng/PromptEng/Building AI-Powered Applications_content">10. Building AI-Powered Applications</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/AIEng/ScalableAI/Introduction to Scalable AI Systems_content">ScalableAI</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">PromptEng</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">09. Advanced Techniques for Image Generation with Stable Diffusion</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>09. Advanced Techniques for Image Generation with Stable Diffusion</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="titles">titles<a href="#titles" class="hash-link" aria-label="Direct link to titles" title="Direct link to titles">​</a></h2>
<p>Advanced Techniques for Image Generation with Stable Diffusion Advanced Techniques for Image Generation with Stable Diffusion Advanced Techniques for Image Generation with Stable Diffusion Advanced Techniques for Image Generation with Stable Diffusion Advanced Techniques for Image Generation with Stable Diffusion</p>
<p>DreamBooth Fine-Tuning and SDXL Refiner Advanced Techniques for Image Generation with Stable Diffusion</p>
<p>SDXL and Refinement</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">summary<a href="#summary" class="hash-link" aria-label="Direct link to summary" title="Direct link to summary">​</a></h2>
<ul>
<li>Chapter 9 explores advanced techniques for image generation using Stable Diffusion, offering more creative control and the ability to train custom models for specific tasks.</li>
<li>Stable Diffusion is highlighted as an open-source image generation model that can be run locally or in the cloud, with specific requirements for NVIDIA or AMD GPU, or Apple Silicon.</li>
<li>The chapter details the setup process for Stable Diffusion, including using Google Colab for cloud-based GPU access and installing necessary dependencies via the Hugging Face diffusers library.</li>
<li>A step-by-step breakdown of creating an inference pipeline with Stable Diffusion is provided, including importing libraries, loading pretrained models, and configuring the model for GPU usage.</li>
<li>The process of generating images with specific prompts, random seeds, inference steps, and guidance scale is explained, emphasizing the reproducibility of results with the same model and seed.</li>
<li>Stability AI&#x27;s Dream-Studio is introduced as a hosted web interface for Stable Diffusion, offering advanced functionality like inpainting and API access for programmatic image generation.</li>
<li>The chapter discusses the AUTOMATIC1111 web user interface, recommended for its feature-rich environment and community-built extensions, enabling advanced functionalities like image-to-image, upscaling, and inpainting.</li>
<li>Installation and setup instructions for AUTOMATIC1111 are provided, including downloading models from Hugging Face and running the web interface locally.</li>
<li>Warnings are given about NSFW content in some custom models and the potential for deprecated features in future versions of Stable Diffusion.</li>
<li>The chapter concludes with practical advice for troubleshooting and updating the AUTOMATIC1111 web UI, including resetting the implementation if necessary.</li>
<li>Important images include a photograph of an astronaut riding a horse, a Corporate Memphis illustration from the Dream-Studio API, and screenshots of the Stable Diffusion web UI and Dream-Studio interface.</li>
<li>The chapter delves into advanced techniques for image generation using Stable Diffusion, focusing on the AUTOMATIC1111 web UI for enhanced control and creativity.</li>
<li>Negative prompts are introduced as a method to remove unwanted concepts from generated images, with settings like Seed, Sampling Steps, Batch Count, and Batch Size detailed for customization.</li>
<li>The importance of the Stable Diffusion Checkpoint drop-down menu is highlighted for selecting base models and adjusting settings like image size and the &#x27;Switch at&#x27; parameter for refiner models.</li>
<li>Sampling methods such as Euler, DDIM, DPM++ 2M Karras, and UniPC are compared for their trade-offs in speed, quality, and randomness, with recommendations for robust and reproducible images.</li>
<li>The CFG Scale parameter is explained with common values and their effects on prompt adherence and creativity, alongside other settings like Highres fix, Restore faces, and Tiling.</li>
<li>Prompt weights and editing techniques are covered, showing how to emphasize or de-emphasize terms and switch prompts during the diffusion process for creative control.</li>
<li>Img2Img functionality is explored, allowing users to guide image generation with an uploaded image, with tips on denoising strength, CFG scale, and Seed for optimal results.</li>
<li>The X/Y/Z Plot feature in AUTOMATIC1111 is introduced for testing multiple parameter values, generating grids of images to visually identify quality sweet spots.</li>
<li>Upscaling images to higher resolution is detailed, including the use of the SD Upscale script and selecting upscalers like R-ESRGAN 4x+, with advice on modifying prompts for better detail retention.</li>
<li>The PNG Info tab is mentioned for retrieving metadata on generated images, ensuring users can recall settings and prompts used.</li>
<li>Images described include settings panels for Stable Diffusion, examples of prompt editing effects, and interfaces for Img2Img and upscaling, illustrating the advanced techniques discussed.</li>
<li>The chapter explores advanced techniques for image generation using Stable Diffusion, emphasizing the use of AUTOMATIC1111 web UI for enhanced control and creativity.</li>
<li>Upscaling images to higher resolution is detailed, with recommendations for high number of steps, CFG scale, and Denoising strength to maintain image integrity.</li>
<li>The Interrogate CLIP feature is introduced for reverse engineering prompts from images, similar to Midjourney’s Describe feature.</li>
<li>SD Inpainting and Outpainting functionalities are covered, including the use of specific inpainting models and the iterative process of fixing image artifacts.</li>
<li>ControlNet is presented as an advanced method for conditioning input images, allowing more control over the final image through techniques like edge detection and pose matching.</li>
<li>Installation and setup instructions for the ControlNet extension in AUTOMATIC1111 are provided, including troubleshooting tips.</li>
<li>The chapter discusses the importance of experimenting with different ControlNet models and adjusting parameters for optimal results.</li>
<li>Canny edge detection is highlighted as a generally useful model for detailed image control, with examples of its application.</li>
<li>The interface and settings for ControlNet in AUTOMATIC1111 are explained, including Control Weight, Starting and Ending Control Steps, and Preprocessor Resolution.</li>
<li>The chapter concludes with practical advice on selecting and downloading ControlNet models, emphasizing the transferability of techniques across different Stable Diffusion versions.</li>
<li>Images described include examples of upscaling effects, inpainting and outpainting results, and ControlNet interface screenshots, illustrating the advanced techniques discussed.</li>
<li>The chapter delves into advanced techniques for image generation using Stable Diffusion, focusing on the use of ControlNet for enhanced control over image composition and style.</li>
<li>ControlNet&#x27;s various models, including Canny edge detection, Depth, Normal, OpenPose, M-LSD, and SoftEdge, are explored for their specific applications in image generation.</li>
<li>The importance of matching preprocessors with their corresponding models in ControlNet is emphasized to ensure coherent image generation.</li>
<li>The Segment Anything Model (SAM) is introduced as a powerful tool for automatically segmenting images, facilitating tasks like inpainting and background replacement.</li>
<li>Installation and setup instructions for the SAM extension in AUTOMATIC1111 are provided, including troubleshooting tips for users with limited VRAM.</li>
<li>Practical examples demonstrate the application of these techniques, such as transforming a modern apartment into a Mad Men era setting and reimagining classical paintings with contemporary figures.</li>
<li>The chapter highlights the iterative nature of working with Stable Diffusion and ControlNet, encouraging experimentation to achieve desired results.</li>
<li>Images described include examples of ControlNet applications, SAM segmentation results, and the interface for these tools within AUTOMATIC1111, illustrating the advanced techniques discussed.</li>
<li>DreamBooth fine-tuning allows for custom model training on top of Stable Diffusion, enabling the creation of personalized models with as few as 5-30 images, significantly reducing the time and resources required compared to training a foundational model from scratch.</li>
<li>The process involves selecting a base model, uploading concept images, and training the model to understand new concepts or styles, with the output being a new model file that can be used within AUTOMATIC1111.</li>
<li>Training is optimized for Nvidia GPUs and can be conducted in environments like Google Colab, with the model weights saved for later use in generating images that adhere to the trained concepts or styles.</li>
<li>The Stable Diffusion XL (SDXL) v1.0 model introduces a refiner model that works in conjunction with the base model to enhance image details, offering improved results over previous versions.</li>
<li>DreamBooth models require specific tokens in prompts to trigger the desired output, emphasizing the importance of careful prompt engineering when using these customized models.</li>
<li>Alternative fine-tuning methods like Textual Inversion, LoRA, and Hypernetworks are mentioned, though DreamBooth remains the most prevalent due to its effectiveness and quality of results.</li>
<li>The chapter provides practical examples, including generating AI profile photos or product photography, showcasing the versatility and creative potential of DreamBooth fine-tuning.</li>
<li>Images described include examples of DreamBooth model outputs and the interface for training models within AUTOMATIC1111, illustrating the advanced techniques discussed.</li>
<li>The chapter concludes with advanced techniques in image generation using Stable Diffusion, focusing on the SDXL model and its refiner for enhanced image quality.</li>
<li>SDXL combines OpenClip and OpenAI&#x27;s CLIP ViT-L for improved prompt interpretation, addressing previous issues with prompt transferability from v1.5.</li>
<li>The refiner model is utilized by setting a &#x27;Switch at&#x27; parameter in AUTOMATIC1111, allowing for a transition from the base model to the refiner at a specified step for finer details.</li>
<li>Optimal results are achieved with a switch value between 0.4 and 1.0 and 20–50 sampling steps, with 0.6 and 30 steps recommended for high-quality images.</li>
<li>An aspect ratio selector extension is introduced for convenience, enabling quick adjustments to image sizes and aspect ratios, with preset configurations provided for both SD and XL models.</li>
<li>The summary recaps the installation of Stable Diffusion, the use of ControlNet for style control, Segment Anything for image masking, and DreamBooth for model personalization.</li>
<li>The chapter sets the stage for the next, which will apply these techniques in building an AI blog post generator capable of producing text and matching images in a consistent style.</li>
<li>Images described include a bar chart comparing model performance preferences, interface screenshots for refiner parameter settings, and aspect ratio configurations, illustrating the discussed techniques.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-snippets">code snippets<a href="#code-snippets" class="hash-link" aria-label="Direct link to code snippets" title="Direct link to code snippets">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">!pip install diffusers==0.11.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!pip install transformers scipy ftfy accelerate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from diffusers import StableDiffusionPipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe = StableDiffusionPipeline.from_pretrained(&quot;CompVis/stable-diffusion-v1-4&quot;, torch_dtype=torch.float16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe = pipe.to(&quot;cuda&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompt = &quot;a photograph of an astronaut riding a horse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">generator = torch.Generator(&quot;cuda&quot;).manual_seed(1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image = pipe(prompt, num_inference_steps=50, guidance_scale=7, generator=generator).images[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image.save(f&quot;astronaut_rides_horse.png&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from IPython.display import Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine_id = &quot;stable-diffusion-xl-1024-v1-0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_host = os.getenv(&#x27;API_HOST&#x27;, &#x27;https://api.stability.ai&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_key = os.getenv(&quot;STABILITY_API_KEY&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response = requests.post(f&quot;{api_host}/v1/generation/{engine_id}/text-to-image&quot;, headers={&quot;Content-Type&quot;: &quot;application/json&quot;, &quot;Accept&quot;: &quot;application/json&quot;, &quot;Authorization&quot;: f&quot;Bearer {api_key}&quot;}, json={&quot;text_prompts&quot;: [{&quot;text&quot;: prompt}], &quot;cfg_scale&quot;: 7, &quot;height&quot;: 1024, &quot;width&quot;: 1024, &quot;samples&quot;: 1, &quot;steps&quot;: 30})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if not os.path.exists(&quot;./out&quot;): os.makedirs(&quot;./out&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i, image in enumerate(data[&quot;artifacts&quot;]): filename = f&quot;./out/image-{i}.png&quot;; with open(filename, &quot;wb&quot;) as f: f.write(base64.b64decode(image[&quot;base64&quot;])); image_paths.append(filename)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image(filename=image_paths[0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!nvidia-smi --query-gpu=name,memory.total, memory.free --format=csv,noheader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!wget -q https://github.com/ShivamShrirao/diffusers/raw/main/examples/dreambooth/train_dreambooth.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!wget -q https://github.com/ShivamShrirao/diffusers/raw/main/scripts/convert_diffusers_to_original_stable_diffusion.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%pip install -qq git+https://github.com/ShivamShrirao/diffusers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%pip install -q -U --pre triton</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%pip install -q accelerate transformers ftfy bitsandbytes==0.35.0 gradio natsort safetensors xformers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!python3 train_dreambooth.py --pretrained_model_name_or_path=$MODEL_NAME --pretrained_vae_name_or_path=&quot;stabilityai/sd-vae-ft-mse&quot; --output_dir=$OUTPUT_DIR --revision=&quot;fp16&quot; --with_prior_preservation --prior_loss_weight=1.0 --seed=1337 --resolution=512 --train_batch_size=1 --train_text_encoder --mixed_precision=&quot;fp16&quot; --use_8bit_adam --gradient_accumulation_steps=1 --learning_rate=1e-6 --lr_scheduler=&quot;constant&quot; --lr_warmup_steps=0 --num_class_images=50 --sample_batch_size=4 --max_train_steps=800 --save_interval=10000 --save_sample_prompt=&quot;photo of ukj person&quot; --concepts_list=&quot;concepts_list.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!python convert_diffusers_to_original_stable_diffusion.py --model_path $WEIGHTS_DIR --checkpoint_path $ckpt_path $half_arg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/stable-diffusion">Stable Diffusion</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/automatic-1111">AUTOMATIC1111</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/dream-studio">Dream-Studio</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/control-net">ControlNet</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/hugging-face">Hugging Face</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/img-2-img">Img2Img</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/prompt-editing">Prompt Editing</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/upscaling">Upscaling</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/inpainting">Inpainting</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/segment-anything-model-sam">Segment Anything Model (SAM)</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/image-generation">Image Generation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/dream-booth">DreamBooth</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/fine-tuning">Fine-Tuning</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/sdxl-refiner">SDXL Refiner</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/sdxl">SDXL</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/refiner-model">Refiner Model</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/aspect-ratio">Aspect Ratio</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/AIEng/PromptEng/Standard Practices for Image Generation with Midjourney_content"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">08. Standard Practices for Image Generation with Midjourney</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/AIEng/PromptEng/Building AI-Powered Applications_content"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">10. Building AI-Powered Applications</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#titles" class="table-of-contents__link toc-highlight">titles</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">summary</a></li><li><a href="#code-snippets" class="table-of-contents__link toc-highlight">code snippets</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/learn-with-ai/kb" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>